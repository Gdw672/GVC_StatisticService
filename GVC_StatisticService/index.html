<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Отчет по данным</title>
  <link rel="stylesheet" href="styles.css">
  <script src="plotly-3.0.1.min.js" charset="utf-8"></script>
</head>
<body>
   <div class="header">
    <div class="container">
      <div class="header-content">
        <h1>Отчет по данным</h1>
        <div class="log-container">
          <div class="log-box">
              
        </div>
         </div>

        <div class="authsect">
          <input id="login" class="form-input hidden" type="text" placeholder="GVC\ФамилияИО" required>
          <input id="password" class="form-input hidden" type="password" placeholder="Пароль" maxlength="30" minlength="14" required>
          <button id="savepasswordButton" class="btn btn-xs btn-secondary btn-password hidden">!</button>
          <button id="passwordButton" class="btn btn-xs btn-secondary btn-password">⛭</button>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="filters-section">
      <div id="dateFilters" class="date-filters">
        <div class="date-filter">
          <label for="startDate">Дата начала:</label>
          <input type="date" id="startDate" class="form-input" value="2025-07-01">
        </div>
        <select name="Диапазон" id="rangeData" class="form-input">
  <option value="">Промежуток</option>
  <option value="week">Неделя</option>
  <option value="doubleweek">Две недели</option>
  <option value="month">Месяц</option>
  <option value="quarter">Квартал</option>
  <option value="year">Год</option>
</select>
        <div class="date-filter">
          <label for="endDate">Дата окончания:</label>
          <input type="date" id="endDate" class="form-input" value="2025-07-31">
        </div>
        <button id="loadDataButton" class="btn btn-primary">Нет базы данных</button>
          <button id="downloadHideButton" class="btn btn-xs btn-secondary right">⇩</button>
      </div>
    </div>
    

      <div class="section hidden" id="downloadContainer">
        <div class="download-section">
          <p>Выберите диапазон дат для проверки данных:</p>
          <div class="date-filters">
            <div class="date-filter">
              <label for="downloadstartDate">Дата начала:</label>
              <input type="date" id="checkStartDate" class="form-input" value="2025-07-15">
            </div>
             <select name="Диапазон" id="checkrangeData" class="form-input">
  <option value="">Промежуток</option>
  <option value="week">Неделя</option>
  <option value="doubleweek">Две недели</option>
  <option value="month">Месяц</option>
  <option value="quarter">Квартал</option>
  <option value="year">Год</option>
</select>
            <div class="date-filter">
              <label for="downloadendDate">Дата окончания:</label>
              <input type="date" id="checkEndDate" class="form-input" value="2025-07-18">
            </div>
            <button id="checkDataButton" class="btn btn-primary">Проверить</button>
          </div>
        </div>
    </div>
    </div>
    
<div class="tablecontainer"> 
    <div class="section table-section">
      <div class="section-header">
        <div class="section-name-header">
          <h2 class="section-title">Таблица</h2>
  
          <button id="toggleButton" class="btn btn-secondary export">Изменить вид</button>
          <button id="csv-Button" class="btn btn-secondary export">Экспортировать в csv</button>
          <button id="xlsx-Button" class="btn btn-secondary export">Экспортировать в xlsx</button>
        </div>

        <button id="resetButton" class="btn btn-secondary btn-xs right">↻</button>
        <div class="section-slider">
          
          <div class="slider-container">
            <input type="range" min="0" max="100" value="50" class="sliderV" id="mySliderV">
          </div>
          <div class="slider-container">
            <input type="range" min="0" max="100" value="50" class="sliderH" id="mySliderH">
          </div>
        </div>
      </div>
      

      <div id="tableContainer" class="table-container"></div>
      <div class="resize-handle-right"></div>
      </div>
 </div>

    <div class="container">
    <div id="listsContainer" class="section lists-container"></div>
    <div class="section">
      <div id="chartsContainer" class="charts-grid"></div>
    </div>
  </div>


  <!-- Подключаем модули -->
  <script src="table-manager.js"></script>
  <script src="chart-manager.js"></script>
  
  <script>



let lastScrollTop = 0;
window.addEventListener('scroll', () => {
  const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
  if (scrollTop > 50) { // Скрываем после прокрутки на 50px
    document.body.classList.add('scrolled');
  } else {
    document.body.classList.remove('scrolled');
  }
  lastScrollTop = scrollTop;
});

document.addEventListener('DOMContentLoaded', function() {
    const tabBtn = document.querySelector('.tab-btn');
    const tabContent = document.querySelector('.tab-content');
    
    if (tabBtn && tabContent) {
        tabBtn.addEventListener('click', function() {
            // Переключаем класс active у кнопки
            tabBtn.classList.toggle('active');
            
            // Переключаем видимость контента
            if (tabContent.style.display === 'none') {
                tabContent.style.display = '';
            } else {
                tabContent.style.display = 'none';
            }
        });
    }
});


const sliderV = document.getElementById("mySliderV");
const sliderH = document.getElementById("mySliderH");

// Функция обновления стилей
function updateStyles() {
    // Получаем значения слайдеров
    const valueV = sliderV.value;
    const valueH = sliderH.value;

if (document.querySelector(".table-container table")) {
   // Применяем значения слайдеров к стилям (исключая первую ячейку)
  if (document.querySelector(".table-container table")) {
    // Применяем значения слайдеров к стилям (исключая первую ячейку)
    document.querySelectorAll(".table-container th:not(:first-child)").forEach(th => {
        th.style.fontSize = Math.max(5, valueV / 5) + "px";
        th.style.padding = Math.max(1, valueV / 10) + "px";
        
        // Плавные переходы для всех свойств
        th.style.transition = "all 0.2s ease";
        
        // Перенос текста для маленьких значений
        if (valueV < 50) {
            th.style.whiteSpace = "normal"; // разрешает перенос
            th.style.wordWrap = "break-word"; // переносит длинные слова
            th.style.wordBreak = "break-word"; // дополнительная поддержка
        } else {
            th.style.whiteSpace = "nowrap"; // запрещает перенос
        }
        
        // Плавное изменение по вашей логике
        if (valueV < 30) {
            th.style.fontWeight = 100 + (valueV / 30) * 500;
            th.style.letterSpacing = (0.2 * (30 - valueV) / 30) + "px";
            th.style.lineHeight = 3 - ((valueV / 30) * 1.9);
        } else if (valueV > 70) {
            th.style.fontWeight = 600 + ((valueV - 70) / 30) * 100;
            th.style.lineHeight = 1.1 - ((valueV - 70) / 30) * 1;
            th.style.letterSpacing = "0px";
        } else {
            th.style.fontWeight = "700";
            th.style.lineHeight = "1.1";
            th.style.letterSpacing = "0px";
        }
    });
}

    document.querySelector(".table-container table").style.lineHeight = (valueH / 100) + 0.001;  // Например, от 0 до 1
}
}

// Добавляем события для слайдеров
sliderV.addEventListener("input", updateStyles);
sliderH.addEventListener("input", updateStyles);





// Инициализация начальных значений
updateStyles();

    // Инициализация приложения
    const APP_CONFIG = {
      apiUrl: "http://localhost:5134/api/Database/getReportsByRange",
      tableContainer: "tableContainer",
      listsContainer: "listsContainer",
      chartsContainer: "chartsContainer",
      toggleButton: "toggleButton",
      startDateInput: "startDate",
      endDateInput: "endDate",
      loadDataButton: "loadDataButton"
    };

    // Глобальное состояние приложения
    window.AppState = {
      originalData: [],
      selectedParamsByList: [[]],
      selectedDates: [],
      activeListIndex: 0,
      transposed: true, // Стартуем в перевернутом виде
      chartsVisible: [] // массив булевых значений для видимости графиков
    };
    
    // Инициализируем менеджеры
    document.addEventListener('DOMContentLoaded', async () => {
      // Делаем менеджеры доступными глобально
      window.TableManager = TableManager;
      window.ChartManager = ChartManager;
      
      TableManager.init(APP_CONFIG);
      ChartManager.init(APP_CONFIG);
      
      // Загружаем данные
      await TableManager.loadData();
    });
  </script>
</body>
</html>
    
  