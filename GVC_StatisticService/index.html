<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Отчет по данным</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h3>Отчет по данным</h3>
  
  <!-- Поля выбора даты -->
  <div id="dateFilters">
    <div class="date-filter">
      <label for="startDate">Дата начала:</label>
      <input type="date" id="startDate" value="2025-07-15">
    </div>
    <div class="date-filter">
      <label for="endDate">Дата окончания:</label>
      <input type="date" id="endDate" value="2025-07-17">
    </div>
    <button id="loadDataButton">Загрузить данные</button>
  </div>
  
  <button id="toggleButton">Повернуть таблицу</button>
  <div id="tableContainer"></div>

  <h4>График по тегам</h4>
  <div id="listsContainer"></div>
  <button id="addListButton">+ Добавить новый график</button>

  <h4>Графики</h4>
  <div id="chartsContainer"></div>

  <!-- Подключаем модули -->
  <script src="table-manager.js"></script>
  <script src="chart-manager.js"></script>
  
  <script>
    // Инициализация приложения
    const APP_CONFIG = {
      apiUrl: "http://localhost:5134/api/Database/getReportsByRange",
      tableContainer: "tableContainer",
      listsContainer: "listsContainer",
      chartsContainer: "chartsContainer",
      toggleButton: "toggleButton",
      addListButton: "addListButton",
      startDateInput: "startDate",
      endDateInput: "endDate",
      loadDataButton: "loadDataButton"
    };

    // Глобальное состояние приложения
    window.AppState = {
      originalData: [],
      selectedParamsByList: [[]],
      selectedDates: [],
      activeListIndex: 0,
      transposed: true, // Стартуем в перевернутом виде
      chartsVisible: [] // массив булевых значений для видимости графиков
    };
    
      // Инициализируем 
    document.addEventListener('DOMContentLoaded', async () => {
      TableManager.init(APP_CONFIG);
      ChartManager.init(APP_CONFIG);
      
      // Автоматически инициализируем и заполняем БД
      await TableManager.initDatabase();
      await TableManager.fillDatabase();
      
      // Загружаем данные
      await TableManager.loadData();
    });
  </script>
</body>
</html>